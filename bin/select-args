#!/bin/bash

prompt="Please enter your selection: "
TEMP=$(getopt -o p:i: --long prompt:init: -n $(basename $0) -- "$@")
eval set -- "$TEMP"
while true; do
    case "$1" in
        -p|--prompt)
            prompt=$2
            shift 2
            ;;
        -i|--init)
            export ORIGINAL_MATCHER=$2
            shift 2
            ;;
        --)
            shift
            break
            ;;
        *)
            die "internal error"
            ;;
    esac
done
mv ~/.logs/last-selected-arg ~/.logs/last-selected-arg.$$ >/dev/null 2>&1 ||true
select-output-line -p "$prompt" -- bash -c '(cat '~/.logs/last-selected-arg.$$'; echo; for x in "$@"; do echo "$x"; done)|uniq-even-non-ajacent' true "$@" |tee ~/.logs/last-selected-arg
rm ~/.logs/last-selected-arg.$$ -f
