#!/bin/bash

set -e
port=8888
if test $# = 0; then
    set -- tiny
fi
if test "$1" = tiny; then
    shift
    if ! type tinyproxy >/dev/null 2>&1; then
        sudo apt-get install -y tinyproxy
    fi
    sudo ps-killall tinyproxy
    sudo tsocks tinyproxy
elif type ziproxy >/dev/null 2>&1; then
    port=8080
    sudo /etc/init.d/ziproxy stop || true
    sudo ps-killall ziproxy
    tsocks ziproxy -d
fi

export http_proxy=localhost:$port
export https_proxy=localhost:$port
sleep 1
if test "$#" != 0; then
   "$@"
else
    start_recursive_shell proxy=set
fi
