#!/bin/bash

if test "$1" -a "$1" != elf; then
    date=2014$1
    shift
    if test "$1" -a "$1" != elf; then
        tag=$1
        shift
    else
        tag=
    fi
else
    TEMP=$(getopt -o u: --long utc: -n $(basename $0) -- "$@")
    utc=
    eval set -- "$TEMP"
    while true; do
        case "$1" in
            -u|--utc)
                utc=$2
                shift 2
                ;;
            --)
                shift
                break
                ;;
            *)
                die "internal error"
                ;;
        esac
    done

    if test ! "$utc"; then
        utc=$(adb getprop ro.build.date.utc)
    fi
    time=$(epoch2date $utc)
    date=$(echo $time | perl -npe 's/T.*//; s/-//g')
    tag=$(echo $time | perl -npe 's/-//g; s/T/-/; s/://g')
fi

if test "$1" = elf; then
    cd ~/smb/share.smartisan.cn/SanFranciscoBuild/elf/release-$date
else
    cd ~/smb/share.smartisan.cn/SanFranciscoBuild/sanfrancisco_android/release-$date
fi

if test "$(echo *$tag*)" != "*$tag*"; then
    for x in *$tag*; do
        builtin cd $x;
        break
    done
fi
pwd
if is-tty-io; then
    pwd|putclip
fi
