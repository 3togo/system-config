#!/bin/bash

export USE_BUFFER_NAME=send-to-weixin.org
(
    if ! flock -n 9; then
        find-or-exec emacs "No such thing"
        emacsclient -e '(switch-to-buffer "send-to-weixin.org")'
        exit
    fi
    while true; do
        input=$(ask-for-input-with-emacs -p "What do you want say on weixin?" || true)
        if ! test "$input"; then
            exit
        fi
        putclip-android "$input"
        sleep 2
        adb-long-press 300 1850
        adb-tap 129 873
        adb-tap 1000 1020
        adb shell input keyevent BACK
    done
) 9> ~/.logs/$(basename $(readlink -f $0)).lock
