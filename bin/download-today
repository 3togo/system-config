#!/bin/bash

set -e
cd ~/Downloads
dir=$(today)
dir=${dir%-*}
mkdir -p $dir

if test -e ~/Downloads/today -a ! -L ~/Downloads/today; then
    mv ~/Downloads/today ~/Downloads/today.$$
fi
rm -f ~/today ~/last-month ~/Downloads/today
relative-link $(pwd)/$dir ~/today
relative-link ~/today ~/Downloads/today

if test -d ~/Downloads/today.$$; then
    mv ~/Downloads/today.$$/* ~/Downloads/today/
    rmdir ~/Downloads/today.$$
fi

dir=$(today 'last month')
dir=${dir%-*}
relative-link $(pwd)/$dir ~/last-month
relative-link ~/Downloads/forever/* ~/today/ >/dev/null 2>&1 || true
rm ~/today/\* -f
relative-link ~/Downloads/forever/ ~/today/ >/dev/null 2>&1 ||true
rm ~/.cache/open-in-emacs.d/ -rf || true
