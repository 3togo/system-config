#!/bin/bash

## start generated code
TEMP=$(getopt -o c:p:P:n:e: --long "picture:phone:name:email:comment:"  -n $(basename $0) -- "$@")
picture=~/src/tools/SmartisanPhotos/smartisan.jpg
phone=
name=
email=
comment=锤子
eval set -- "$TEMP"
while true; do
    case "$1" in
        -P|--picture)
            picture=$2
            shift 2
            ;;
        -p|--phone)
            phone=$2
            shift 2
            ;;
        -n|--name)
            name=$2
            shift 2
            ;;
        -c|--comment)
            comment=$2
            shift 2
            ;;
        -e|--email)
            email=$2
            shift 2
            ;;
        --)
            shift
            break
            ;;
        *)
            die "internal error"
            ;;
    esac
done

## end generated code
adb start-activity com.android.contacts/com.android.contacts.activities.DialtactsActivity
adb-tap 366 1865
adb-tap-top-right
putclip-android "$name"
adb-long-press 355 296
adb-tap 291 270

adb-tap 81 742 # get rid of hint

if test "$picture"; then
    adb-picture-to-phone "$picture"
    adb-tap 144 363
    adb-tap 164 676
    sleep 1
    adb-tap 344 318
    sleep 1
    adb-tap 104 418
    for x in $(seq 1 5); do
        if adb-is-activity com.android.gallery3d/com.android.gallery3d.app.CropImage; then
            break
        fi
        sleep .5
    done
    adb-tap 721 1866
    adb-picture-clean
fi

putclip-android "$comment"
adb-tap 413 749
adb-long-press 413 749
adb-tap 302 633

adb-tap 467 927
sendtext-android "$phone"
