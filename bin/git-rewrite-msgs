#!/bin/bash

set -e
function die() {
    echo Error: "$@"
    exit -1
}

if test $# != 1; then
    die "Error: Usage $(basename $0) REV"
fi
list=$(git rev-list HEAD ^$1|reverse)

git reset --hard $1
if test $(basename $0) = git-rework-change; then
    start_recursive_shell
fi

git commit --amend --allow-empty

for x in $list; do
    git cherry-pick $x
done
