#!/bin/bash

export USE_BUFFER_NAME=send-to-$(basename $0).org
(
    if ! flock -n 9; then
        find-or-exec emacs "No such thing"
        emacsclient -e '(switch-to-buffer "'$USE_BUFFER_NAME'")'
        exit
    fi
    while true; do
        input=$(ask-for-input-with-emacs -p "What do you want say on $(basename $0)?" || true)
        if ! test "$input"; then
            exit
        fi
        putclip-android "$input"&
        adb-tap 560 1840 # 再点一下，可能在出键盘，需要输入一个空格
        adb-long-press 560 976 # 长点输入框
        adb-tap 525 855 # 点一下粘贴钮
        adb-tap 976 976 # 点一下发送钮
    done
) 9> ~/.logs/$(basename $0).lock
