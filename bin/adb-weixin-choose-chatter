#!/bin/bash
if echo $SHELLOPTS | grep xtrace; then
    function debug() {
        read -p "press any key to continue..."
    }
else
    function debug() {
        sleep .5
    }
fi

if test "$(basename $0)" = adb-call && ! echo "$1" | grep -q -P -e '^\d+$'; then
    true
else
    putclip-android "$1"
fi
debug
if test "$(basename $0)" = adb-weixin-choose-chatter; then
    adb am start -n com.tencent.mm/.ui.LauncherUI
    sleep .5
    adb-tap-2 141 178
    adb-tap-2 141 178
    for x in $(seq 1 10); do
        adb-tap 642 144
        if adb-is-activity com.tencent.mm/com.tencent.mm.plugin.search.ui.SearchContactUI; then
            break
        fi
        sleep .5
    done
    adb-long-press 375 137
    adb-tap 275 405
    adb-tap 248 474
elif test "$(basename $0)" = adb-call; then
    adb am start -n com.android.contacts/.activities.DialtactsActivity >/dev/null 2>&1 &
    sleep .5
    if ! echo "$1" | grep -q -P -e '^\d+$'; then
        number=$(select-output-line 'bbdb '"$1"'|perl -npe "s/\\\\n/\\n/g"' | grep -o -P '\d+$')
        if test "$number"; then
            set -- "$number"
        fi
    fi

    if echo "$1" | grep -q -P -e '^\d+$'; then
        adb-tap-2 614 1829
        adb-long-press 898 1689 .8
        sendtext-android "$1"
        adb-tap 479 1640
        exit
    fi

    adb-tap-2 332 1879
    adb-tap 132 260
    adb-long-press 183 146
    adb-tap 72 403
    adb-tap 253 270
    adb-tap 637 665
elif test "$(basename $0)" = adb-qq-choose-chatter; then
    adb am start -n com.tencent.mobileqq/.activity.SplashActivity
    debug
    while true; do
        window=$(adb dumpsys window|grep mFocusedWindow)
        if echo $window|grep -q SplashActivity; then
            break
        else
            adb-key BACK
        fi
    done
    adb-tap-mid-bot
    adb-tap 433 284
    sleep .2
    adb-long-press 190 149
    adb-tap 79 391
    debug
    adb-tap 287 272
    debug
    adb-tap 616 1830
fi
